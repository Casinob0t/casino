<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Crash</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body{background:#0b0f17;color:#fff;font-family:sans-serif}
.box{max-width:420px;margin:auto;padding:16px}
h1{margin:0}
button{padding:12px;border-radius:12px;border:none;font-weight:700}
.start{background:#2ae98b}
.cash{background:#555;color:#fff}
</style>
</head>
<body>
<div class="box">
<h1>Crash</h1>
<p>Balance: <span id="bal">—</span></p>
<p id="msg"></p>
<input id="bet" value="10"><br><br>
<button class="start" onclick="start()">Start</button>
<button class="cash" onclick="cash()" disabled id="cash">Cash Out</button>
</div>

<script>
const API = "https://crash.ajresellss.workers.dev";
const tg = Telegram.WebApp;
tg.ready();

let roundId = null;

async function api(path, body){
  const r = await fetch(API+path,{
    method: body ? "POST":"GET",
    headers:{
      "Content-Type":"application/json",
      "x-initdata": tg.initData
    },
    body: body ? JSON.stringify(body):null
  });
  return r.json();
}

async function refresh(){
  const s = await api("/api/state");
  bal.textContent = s.balance;
}
refresh();

async function start(){
  const bet = parseInt(document.getElementById("bet").value);
  const r = await api("/api/crash/start",{bet});
  roundId = r.round_id;
  bal.textContent = r.balance;
  msg.textContent = "Running…";
  cash.disabled = false;
}

async function cash(){
  const r = await api("/api/crash/cashout",{round_id:roundId});
  bal.textContent = r.balance;
  msg.textContent = "Won +" + r.profit;
  cash.disabled = true;
}
</script>
</body>
</html>
